<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customers</title>
    <link rel="stylesheet" href="assets/css/plugins/bootstrap.min.css">
    <script src="assets/js/plugins/jquery-3-6-0.min.js"></script>
</head>
<body>
<div class="container my-5">
    <h1 class="mb-4">Customer Inquiries</h1>
    <table id="inquiry-table" class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>City</th>
                <th>Area</th>
                <th>Type</th>
                <th>Bedrooms</th>
                <th>Bathrooms</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div class="modal fade" id="acceptModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="offer-form">
        <div class="modal-header">
          <h5 class="modal-title">Send Offer</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <input type="hidden" name="inquiry_id" id="offer-inquiry-id">
            <div class="mb-3">
                <label class="form-label">Price</label>
                <input type="number" class="form-control" id="offer-price" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Location</label>
                <input type="text" class="form-control" id="offer-location" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Type</label>
                <input type="text" class="form-control" id="offer-type" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Size</label>
                <input type="number" class="form-control" id="offer-size" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Bathrooms</label>
                <input type="number" class="form-control" id="offer-bathrooms" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Bedrooms</label>
                <input type="number" class="form-control" id="offer-bedrooms" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Notes</label>
                <textarea class="form-control" id="offer-notes"></textarea>
            </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Send</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function loadInquiries(){
    $.get('/api/inquiries/', function(data){
        var tbody = $('#inquiry-table tbody').empty();
        data.inquiries.forEach(function(i){
            var row = $('<tr>');
            row.append($('<td>').text(i.id));
            row.append($('<td>').text(i.city));
            row.append($('<td>').text(i.area));
            row.append($('<td>').text(i.property_type));
            row.append($('<td>').text(i.bedrooms || ''));
            row.append($('<td>').text(i.bathrooms || ''));
            var actions = $('<td>');
            actions.append('<button class="btn btn-success btn-sm me-2 btn-accept" data-id="'+i.id+'">Accept</button>');
            actions.append('<button class="btn btn-danger btn-sm btn-reject" data-id="'+i.id+'">Reject</button>');
            row.append(actions);
            tbody.append(row);
        });
    });
}

$(function(){
    loadInquiries();
    $('#inquiry-table').on('click', '.btn-reject', function(){
        var id = $(this).data('id');
        if(confirm('Reject this inquiry?')){
            $.ajax({url:'/api/inquiries/'+id+'/', method:'DELETE', success:loadInquiries});
        }
    });

    $('#inquiry-table').on('click', '.btn-accept', function(){
        var id = $(this).data('id');
        $('#offer-inquiry-id').val(id);
        $('#acceptModal').modal('show');
    });

    $('#offer-form').on('submit', function(e){
        e.preventDefault();
        var id = $('#offer-inquiry-id').val();
        var data = {
            price: $('#offer-price').val(),
            location: $('#offer-location').val(),
            property_type: $('#offer-type').val(),
            size: $('#offer-size').val(),
            bathrooms: $('#offer-bathrooms').val(),
            bedrooms: $('#offer-bedrooms').val(),
            notes: $('#offer-notes').val()
        };
        $.ajax({
            url:'/api/inquiries/'+id+'/',
            method:'POST',
            contentType:'application/json',
            data: JSON.stringify(data),
            success:function(){
                $('#acceptModal').modal('hide');
                loadInquiries();
            }
        });
    });
});
</script>
<script src="assets/js/plugins/bootstrap.min.js"></script>
</body>
</html>
