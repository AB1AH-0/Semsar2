{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Your Properties </title>

     <!--=====FAB ICON=======-->
    <link rel="shortcut icon" href="{% static 'assets/img/logo/fav-logo.png' %}" type="image/x-icon">

    <!--===== CSS LINK =======-->
    <link rel="stylesheet" href="{% static 'assets/css/plugins/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/aos.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/magnific-popup.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/mobile.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/owlcarousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/slick-slider.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/nice-select.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/main.css' %}">

    <!--=====  JS SCRIPT LINK =======-->
    <script src="{% static 'assets/js/plugins/jquery-3-6-0.min.js' %}"></script>

    <style>
      .social-links-mobile-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex; 
  gap: 30px; 
}

.social-links-mobile-menu li {
  display: inline-block;
}

.social-links-mobile-menu a {
  text-decoration: none;
  color: inherit;
  font-size: 20px; 
}

    </style>
</head>
<body class="homepage1-body">

<!--===== PRELOADER STARTS =======-->
<div id="preloader">
  <div class="home-icon">
    <div class="roof"></div>
    <div class="walls"></div>
    <div class="door"></div>
      <div class="windows">
          <div class="window"></div>
          <div class="window"></div>
      </div>
  </div>
  <div id="ctn-preloader" class="ctn-preloader">
    <div class="animation-preloader">
        <div class="txt-loading">
             <span data-text-preloader="S" class="letters-loading">
              S
            </span>
            <span data-text-preloader="E" class="letters-loading">
               E
            </span>
            <span data-text-preloader="M" class="letters-loading">
                M
            </span>
            <span data-text-preloader="S" class="letters-loading">
                S
            </span>
            <span data-text-preloader="A" class="letters-loading">
                A
            </span>
            <span data-text-preloader="R" class="letters-loading">
                R
            </span>
        </div>
    </div>
  </div>
</div>
<!--===== PRELOADER ENDS =======-->

  <!--===== PAGE PROGRESS START=======-->
  <div class="paginacontainer">
    <div class="progress-wrap">
      <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
      </svg>
    </div>
  </div>
<!--===== PAGE PROGRESS END=======-->

   <!--=====HEADER START=======-->
   <header>
    <div class="header-area homepage1 inner-menu header header-sticky d-none d-lg-block " id="header">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="header-elements">
              <div class="site-logo">
                <a href=""><img src="{% static 'assets/img/logo/logo2.png' %}" alt=""></a>
              </div>
              <div class="main-menu">
                <ul>
                  <li><a href="{% url 'home-broker' %}">Home</a></li>
                  <li><a href="{% url 'about-broker' %}">About</a></li>
                  <li><a href="{% url 'add-property' %}">Property</a></li>
                  <li><a href="{% url 'customer' %}">Customers</a></li>
                </ul>
              </div>
              
              <div class="btn-area">
                <a href="{% url 'logout' %}" class="header-btn1">Logout <img src="{% static 'assets/img/icons/arrow1.svg' %}" alt=""></a>
              </div>

              <div class="header-search-form-wrapper">
                <div class="tx-search-close tx-close"><i class="fa-solid fa-xmark"></i></div>
                <div class="header-search-container">
                    <form role="search" class="search-form">
                    <input type="search"  class="search-field" placeholder="Search …" value="" name="s">
                    <button type="submit" class="search-submit"><img src="{% static 'assets/img/icons/search1.svg' %}" alt=""></button>
                    </form>
                </div>
            </div>
            <div class="body-overlay"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!--=====HEADER END =======-->

  <!--===== MOBILE HEADER STARTS =======-->

  <div class="mobile-header mobile-haeder2 d-block d-lg-none">
  <div class="container-fluid">
    <div class="col-12">
      <div class="mobile-header-elements">
        <div class="mobile-logo">
          <a href=""><img src="{% static 'assets/img/logo/logo2.png' %}" alt=""></a>
        </div>
        <div class="mobile-nav-icon dots-menu">
          <i class="fa-solid fa-bars-staggered"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="mobile-sidebar mobile-sidebar2">
  <div class="logosicon-area">
     <div class="site-logo">
        <a href=""><img src="{% static 'assets/img/logo/logo1.png' %}" alt=""></a>
        </div>
    <div class="menu-close">
      <i class="fa-solid fa-xmark"></i>
    </div>
   </div>
  <div class="mobile-nav mobile-nav1">
    <ul class="mobile-nav-list nav-list1">
      <li><a href="{% url 'home-broker' %}" >Home </a></li>
      <li><a href="{% url 'about-broker' %}">About</a></li>
      <li><a href="{% url 'add-property' %}">Property</a></li>
      <li><a href="{% url 'customer' %}">Customers</a></li>
    </ul>
    <div class="allmobilesection">
      <div class="single-footer">
        <h3>Contact Info</h3>
        <div class="footer1-contact-info">
          <div class="contact-info-single">
            <div class="contact-info-icon">
              <span><i class="fa-solid fa-phone-volume"></i></span>
            </div>
            <div class="contact-info-text">
              <a href="tel:+3(924)4596512">+0201020017477</a>
            </div>
          </div>
          
          <div class="single-footer" >
            <h3>Our Location</h3>
            <div class="contact-info-single">
              <div class="contact-info-icon">
                <span><i class="fa-solid fa-location-dot"></i></span>
              </div>
              <div class="contact-info-text">
                <a href="mailto:info@example.com" >57th Street, Al-Bashaer District<br> 6th october, Giza </a>
              </div>
            </div>
          </div>
          <div class="single-footer"  >
            <h3>Social Links</h3> 
            <div class="social-links-mobile-menu" >
              <ul>
                <li><a href="#"><i class="fa-brands fa-facebook-f"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-linkedin-in"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-youtube"></i></a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
     </div>
  </div>
</div>
 
<!--===== MOBILE HEADER STARTS =======-->

<!--===== HERO AREA STARTS =======-->
<div class="inner2-section-area">
  <div class="container">
      <div class="row">
          <div class="col-lg-5 m-auto">
              <div class="inner-header heading1 text-center">
                  <a href="{% url 'home-broker' %}">Home <i class="fa-solid fa-angle-right"></i> <span>Properties </span></a>
                  <div class="space20"></div>
                  <h2>Manage Your Properties</h2>
              </div>
          </div>
      </div>
  </div>
</div>
<!--===== HERO AREA ENDS =======-->

<!--===== PROPERTY AREA STARTS =======-->
<div class="property-inner-area sp1">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
          <div class="listing-tabs-area">
            <ul class="nav nav-pills" id="pills-tab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">For Rent</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">For Sale</button>
              </li>
            </ul>
            <div class="space24"></div>
            <div class="tab-content" id="pills-tabContent">
              <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab" tabindex="0">
                <div class="row">
                  <div class="row" style="justify-content: center;">
                  <div class="col-lg-4">
                    <div class="listing-input">
                        <select id="broker-city-rent" name="broker-city-rent" class="city-select nice-select">
                            <option value="" selected disabled>Governorate</option>
                            <option value="cairo">Cairo</option>
                            <option value="giza">Giza</option>
                        </select>
                    </div>
                    <div class="space24"></div>
                </div>                  
                  <div class="col-lg-4">
                      <div class="listing-input">
                        <select id="broker-area-rent" name="broker-area-rent" class="area-select nice-select">
                          <option value="" disabled selected>Area</option>

                          <!-- CAIRO -->
                          
                          <option value="shubra"          data-city="cairo">Shubra</option>
                          <option value="elmarg"          data-city="cairo">El Marg</option>
                          <option value="dar-el-salam"    data-city="cairo">Dar El Salam</option>
                          <option value="maadi"           data-city="cairo">Maadi</option>
                          <option value="nasr-city"       data-city="cairo">Nasr City</option>
                          <option value="mokattam"        data-city="cairo">Mokattam</option>
                          <option value="new-cairo"       data-city="cairo">New Cairo</option>
                          <option value="garden-city"     data-city="cairo">Garden City</option>
                          <option value="al-rehab-city"   data-city="cairo">Al Rehab City</option>

                          <!-- ===================== GIZA ===================== -->
                          <option value="imbaba"            data-city="giza">Imbaba</option>
                          <option value="boulaq-eldakrour"  data-city="giza">Boulaq El-Dakrour</option>
                          <option value="mohandessin"       data-city="giza">Mohandessin</option>
                          <option value="dokki"             data-city="giza">Dokki</option>
                          <option value="agouza"            data-city="giza">Agouza</option>
                          <option value="beverly-hills"     data-city="giza">Beverly Hills</option>
                          <option value="dream-land"        data-city="giza">Dream Land</option>
                          <option value="sheikh-zayed"      data-city="giza">Sheikh Zayed</option>
                      </select>
                      </div>
                      <div class="space24"></div>
                  </div>
                  </div>
              
                  <div class="col-lg-4">
                    <div class="listing-input">
                      <select name="broker-Type-rent" class="nice-select">
                          <option value="" selected disabled>Type</option>
                          <option value="Roof">Roof</option>
                          <option value="Apartment">Apartment</option>
                          <option value="Duplex">Duplex</option>
                          <option value="Villa">Villa</option>
                      </select>
                  </div>
                    <div class="space24"></div>
                </div>

            <div class="col-lg-4">
              <div class="listing-input">
                <input  type="number"
                        name="broker-bathrooms-rent"
                        class="nice-select"   
                        placeholder="Bathrooms"
                        min="0"              
                        step="1"           
                        inputmode="numeric">             
              </div>
              <div class="space24"></div>
          </div>
          <div class="col-lg-4">
            <div class="listing-input">
              <input  type="number"
                      name="broker-bedrooms-rent"
                      class="nice-select"   
                      placeholder="Bedrooms"
                      min="0"              
                      step="1"           
                      inputmode="numeric">             
            </div>
            <div class="space24"></div>
        </div>

        <div class="col-lg-4">
         <div class="row">
          <div class="col-lg-12">
            <div class="listing-input">
              <input  type="number"
                      name="broker-price-rent"
                      class="nice-select"   
                      placeholder="Price (EGP)"
                      min="0"              
                      step="1000"           
                      inputmode="numeric">             
            </div>
          <div class="space24"></div>
          </div>
          
          </div>
          </div>
          
          <div class="col-lg-4">
            <div class="col-lg-12">
              <div class="listing-input">
                <input  type="number"
                name="broker-size-rent"
                class="nice-select"   
                placeholder="Size (m²)"
                min="0"              
                step="1"           
                inputmode="numeric">             
              </div>
              <div class="space24"></div>
            </div>
            <div class="col-lg-12">
              <div class="listing-input">
                <input placeholder="Add Media (1-15 photos)" type="file" id="property_media_rent" name="media_files" accept="image/*" multiple data-min-files="1" data-max-files="15">
              </div>
              <div class="space24"></div>
          </div>
         </div>

     <div class="col-lg-4">
      <div class="row">
        <div class="col-lg-12">                 
          <div class="listing-input">
            <select name="broker-Furnished-rent" class="nice-select">
                <option value="" selected disabled>Furnish</option>
                <option value="Furnished">Furnished</option>
                <option value="Not-Furnished">Not Furnished</option>
            </select>
        </div>
        <div class="space24"></div>
    </div>
      </div>
   </div>



<div class="col-lg-4">
<div class="btn-area1">
  <button class="header-btn1 send-to-brokers" name="list-property-rent" type="submit" style="margin-top: 10px;"><img src="{% static 'assets/img/icons/search2.svg' %}" alt=""> List Property</button>
  <div class="space24"></div>
</div>
</div>
</div>
</div>
<div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab" tabindex="0">
<div class="row">
  <div class="row" style="justify-content: center;">
  <div class="col-lg-4">
    <div class="listing-input">
        <select id="broker-city-sale" name="broker-city-sale" class="city-select nice-select">
            <option value="" selected disabled>Governorate</option>
            <option value="cairo">Cairo</option>
            <option value="giza">Giza</option>
        </select>
    </div>
    <div class="space24"></div>
</div>                  
  <div class="col-lg-4">
      <div class="listing-input">
        <select id="broker-area-sale" name="broker-area-sale" class="area-select nice-select">
          <option value="" disabled selected>Area</option>

          <!-- CAIRO -->
          
          <option value="shubra"          data-city="cairo">Shubra</option>
          <option value="elmarg"          data-city="cairo">El Marg</option>
          <option value="dar-el-salam"    data-city="cairo">Dar El Salam</option>
          <option value="maadi"           data-city="cairo">Maadi</option>
          <option value="nasr-city"       data-city="cairo">Nasr City</option>
          <option value="mokattam"        data-city="cairo">Mokattam</option>
          <option value="new-cairo"       data-city="cairo">New Cairo</option>
          <option value="garden-city"     data-city="cairo">Garden City</option>
          <option value="al-rehab-city"   data-city="cairo">Al Rehab City</option>

          <!-- ===================== GIZA ===================== -->
          <option value="imbaba"            data-city="giza">Imbaba</option>
          <option value="boulaq-eldakrour"  data-city="giza">Boulaq El-Dakrour</option>
          <option value="mohandessin"       data-city="giza">Mohandessin</option>
          <option value="dokki"             data-city="giza">Dokki</option>
          <option value="agouza"            data-city="giza">Agouza</option>
          <option value="beverly-hills"     data-city="giza">Beverly Hills</option>
          <option value="dream-land"        data-city="giza">Dream Land</option>
          <option value="sheikh-zayed"      data-city="giza">Sheikh Zayed</option>
      </select>
      </div>
      <div class="space24"></div>
  </div>
  </div>

  <div class="col-lg-4">
    <div class="listing-input">
      <select name="broker-Type-sale" class="nice-select">
          <option value="" selected disabled>Type</option>
          <option value="Roof">Roof</option>
          <option value="Apartment">Apartment</option>
          <option value="Duplex">Duplex</option>
          <option value="Villa">Villa</option>
      </select>
  </div>
    <div class="space24"></div>
</div>

<div class="col-lg-4">
<div class="listing-input">
<input  type="number"
        name="broker-bathrooms-sale"
        class="nice-select"   
        placeholder="Bathrooms"
        min="0"              
        step="1"           
        inputmode="numeric">             
</div>
<div class="space24"></div>
</div>
<div class="col-lg-4">
<div class="listing-input">
<input  type="number"
      name="broker-bedrooms-sale"
      class="nice-select"   
      placeholder="Bedrooms"
      min="0"              
      step="1"           
      inputmode="numeric">             
</div>
<div class="space24"></div>
</div>

<div class="col-lg-4">
<div class="row">
<div class="col-lg-12">
<div class="listing-input">
<input  type="number"
      name="broker-price-sale"
      class="nice-select"   
      placeholder="Price (EGP)"
      min="0"              
      step="1000"           
      inputmode="numeric">             
</div>
<div class="space24"></div>
</div>
<div class="col-lg-12">
  <div class="listing-input">
    <select name="broker-Finish-sale" class="nice-select">
      <option value="" selected disabled>Finish</option>
      <option value="Finished">Finished</option>
      <option value="Unfinished">Unfinished</option>
      <option value="Semi-Finished">Semi-Finished</option>
  </select>
  </div>
  <div class="space24"></div>
</div>
</div>
</div>

<div class="col-lg-4">
<div class="col-lg-12">
<div class="listing-input">
<input  type="number"
name="broker-size-sale"
class="nice-select"   
placeholder="Size (m²)"
min="0"              
step="1"           
inputmode="numeric">             
</div>
<div class="space24"></div>
</div>
<div class="col-lg-12">
  <div class="listing-input">
  <input placeholder="Add Media (1-15 photos)" type="file" id="property_media_sale" name="media_files" accept="image/*" multiple data-min-files="1" data-max-files="15">
  </div>
  <div class="space24"></div>
  </div>
</div>

<div class="col-lg-4">
<div class="row">
  <div class="col-lg-12">
    <div class="listing-input">
      <select name="broker-Furnished-sale" class="nice-select">
          <option value="" selected disabled>Furnish</option>
          <option value="Furnished">Furnished</option>
          <option value="Not-Furnished">Not Furnished</option>
      </select>
  </div>
    <div class="space24"></div>
    </div>
</div>
</div>

<div class="col-lg-4">
<div class="btn-area1">
<button class="header-btn1 send-to-brokers" name="list-property-sale" type="submit" style="margin-top: 10px;"><img src="{% static 'assets/img/icons/search2.svg' %}" alt=""> List Property</button>
<div class="space24"></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!--===== PROPERTY AREA ENDS =======-->

<!--===== YOUR PROPERTY LISTINGS SECTION =======-->
<div class="property-listings-section sp1">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="section-title text-center mb-4">
          <h2>Your Listed Properties</h2>
          <p>View and manage the properties you have listed.</p>
        </div>
      </div>
    </div>
    <div class="row" id="broker-property-cards-container">
      <!-- Broker property cards will be dynamically inserted here -->
    </div>
  </div>
</div>

<!--===== BROKER PROPERTY CARD TEMPLATE =======-->
<template id="broker-property-card-template">
  <div class="col-lg-4 col-md-6 mb-4" data-property-id="">
    <div class="property-card">
      <div class="property-img">
        <img src="" alt="Property Image" class="img-fluid">
        <div class="property-tag"><span class="transaction-type"></span></div>
      </div>
      <div class="property-content">
        <div class="property-info">
          <h3 class="property-title"></h3>
          <p class="property-location"><i class="fa-solid fa-location-dot"></i> <span class="location-text"></span> &nbsp;|&nbsp; <i class="fa-solid fa-tag"></i> <span class="property-type"></span></p>
          <div class="property-details">
            <span><i class="fa-solid fa-bed"></i> <span class="bedrooms"></span> Beds</span>
            <span><i class="fa-solid fa-bath"></i> <span class="bathrooms"></span> Baths</span>
            <span><i class="fa-solid fa-ruler-combined"></i> <span class="area"></span> sqm</span>
          </div>
          <div class="property-meta">
            <div class="price"></div>
          </div>
          <div class="text-center mt-3">
              <button class="btn btn-danger btn-sm delete-property-btn">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<!--===== FOOTER AREA STARTS =======-->
<div class="footer1-section-area">
  <div class="container">
    <div class="row">
      <div class="col-lg-4 col-md-6">
        <div class="footer-logo-area">
          <img src="assets/img/logo/logo1.png" alt="">
          <div class="space32"></div>
          <h4>Your dream property comes true</h4>
          <div class="space16"></div>
          <p>At Semsar, we are committed to providing exceptional service and support. Whether you are looking buy or rent in real estate, our team is here help.</p>
          
          <ul>
            <li><a href="#"><i class="fa-brands fa-facebook-f"></i></a></li>
            <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
            <li><a href="#"><i class="fa-brands fa-linkedin-in"></i></a></li>
            <li><a href="#"><i class="fa-brands fa-youtube"></i></a></li>
          </ul>
        </div>
      </div>

      <div class="col-lg col-md-6">
        <div class="footer-header padding-left1">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="{% url 'home-broker' %}">Home</a></li>
            <li><a href="{% url 'about-broker' %}">About Us</a></li>
            <li><a href="{% url 'add-property' %}">Your Properties</a></li>
            <li><a href="{% url 'customer' %}">Customers</a></li>
          </ul>
        </div>
      </div>


      <div class="col-lg col-md-6">
        <div class="footer-header">
          <h3>   Info   </h3>
          <ul>
            <li><span><img src="{% static 'assets/img/icons/location1.svg' %}" alt=""></span><a href="">82 Beside Banque Misr, Maadi, Cairo, Egypt</a></li>
            <li><span><img src="{% static 'assets/img/icons/call1.svg' %}" alt=""></span><a href="tel:0123456789">+20123456789</a></li>
            
          </ul>
        </div>
      </div>
    </div>
    <div class="space50 d-lg-block d-none"></div>
    <div class="space30 d-lg-none d-block"></div>
    <div class="row">
      <div class="col-lg-12">
        <div class="copyright">
          <div class="pera">
            <p>ⓒCopyright 2025 Semsar . All rights reserved</p>
          </div>
          
        </div>
      </div>
    </div>
  </div>
</div>
<!--===== FOOTER AREA ENDS =======-->

<!--===== JS SCRIPT LINK =======-->
<script src="{% static 'assets/js/plugins/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/fontawesome.js' %}"></script>
<script src="{% static 'assets/js/plugins/aos.js' %}"></script>
<script src="{% static 'assets/js/plugins/counter.js' %}"></script>
<script src="{% static 'assets/js/plugins/sidebar.js' %}"></script>
<script src="{% static 'assets/js/plugins/magnific-popup.js' %}"></script>
<script src="{% static 'assets/js/plugins/mobilemenu.js' %}"></script>
<script src="{% static 'assets/js/plugins/owlcarousel.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/nice-select.js' %}"></script>
<script src="{% static 'assets/js/plugins/waypoints.js' %}"></script>
<script src="{% static 'assets/js/plugins/slick-slider.js' %}"></script>
<script src="{% static 'assets/js/plugins/circle-progress.js' %}"></script>
<script src="{% static 'assets/js/plugins/gsap.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/ScrollTrigger.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/Splitetext.js' %}"></script>
<script src="{% static 'assets/js/main.js' %}"></script>
<script>
  $(function () {
    // Initialize nice-select for all select elements
    $('select.nice-select').niceSelect();
    
    // Store all area options for each dropdown
    const allAreaOptions = {};
    
    // Function to store original options
    function storeOriginalOptions(areaSelector) {
        const $area = $(areaSelector);
        // Only store if not already stored
        if (!allAreaOptions[areaSelector] || allAreaOptions[areaSelector].length === 0) {
            allAreaOptions[areaSelector] = [];
            $area.find('option').each(function() {
                const $option = $(this);
                allAreaOptions[areaSelector].push({
                    value: $option.val(),
                    text: $option.text(),
                    city: $option.data('city'),
                    disabled: $option.prop('disabled'),
                    selected: $option.prop('selected')
                });
            });
        }
    }

    // Call storeOriginalOptions for all relevant area dropdowns ONCE here
    // Assuming same IDs/names as property-user.html for 'For Rent' tab
    if ($('#broker-area-rent').length) {
        storeOriginalOptions('#broker-area-rent');
    }
    if ($('#broker-area-sale').length) {
        storeOriginalOptions('#broker-area-sale');
    }
    
    // Function to link city and area dropdowns
    function linkCityAreaDropdowns(citySelector, areaSelector) {
        const $city = $(citySelector);
        const $area = $(areaSelector);
        
        // Check if elements exist to prevent errors
        if (!$city.length || !$area.length || !allAreaOptions[areaSelector]) {
            // console.warn('City or Area selector not found, or original options not stored for:', citySelector, areaSelector);
            return;
        }
        
        function filterAreasByCity() {
            const selectedCity = $city.val();
            $area.empty();
            
            allAreaOptions[areaSelector].forEach(function(option) {
                if (!option.city || option.city === selectedCity) {
                    const $newOption = $('<option>', {
                        value: option.value,
                        text: option.text,
                        disabled: option.disabled && !option.city, 
                        selected: false
                    });
                    
                    if (option.city) {
                        $newOption.data('city', option.city);
                    }
                    $area.append($newOption);
                }
            });
            
            $area.val('');
            $area.niceSelect('destroy');
            $area.niceSelect();
        }
        
        filterAreasByCity(); // Initial filtering
        $city.on('change', filterAreasByCity);
    }
    
    // Setup for RENT tab
    if ($('select[name="broker-city-rent"]').length && $('#broker-area-rent').length) {
        linkCityAreaDropdowns('select[name="broker-city-rent"]', '#broker-area-rent');
    }

    // Setup for SALE tab
    if ($('select[name="broker-city-sale"]').length && $('#broker-area-sale').length) {
        linkCityAreaDropdowns('select[name="broker-city-sale"]', '#broker-area-sale');
    }
  });

  // Capture form data and send including media files
  $(function(){
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
    }

        // --------------------------- VALIDATION --------------------------- //
    function validateForm($panel){
      let missing = [];

      // Validate regular inputs and selects
      $panel.find('input:not([type=\"file\"]):not([type=\"checkbox\"]), select').each(function(){
        const $el = $(this);
        const val = ($el.val() || '').toString().trim();

        // Check for empty value or a disabled placeholder option in a select
        if(val === '' || val === null || $el.find('option:selected').is(':disabled')){
          let fieldName = $el.attr('placeholder') || $el.attr('name');
          if (fieldName) {
              // Clean up the name for a more readable alert
              fieldName = fieldName.replace(/broker-|-rent|-sale/g, ' ').replace(/_/g, ' ').trim();
              fieldName = fieldName.charAt(0).toUpperCase() + fieldName.slice(1); // Capitalize
              missing.push(fieldName);
          }
        }
      });

      // Validate file inputs to ensure at least one file is selected
      $panel.find('input[type=\"file\"]').each(function(){
        const minFiles = parseInt($(this).data('min-files')) || 1;
        if(this.files.length < minFiles){
          let fieldName = $(this).attr('placeholder') || $(this).attr('name');
          missing.push(fieldName || 'Media files');
        }
      });

      if(missing.length){
        // Use a Set to remove any duplicate field names from the alert
        const uniqueMissing = [...new Set(missing)];
        alert('Please complete the following required fields:\n\n- ' + uniqueMissing.join('\n- '));
        return false;
      }
      return true;
    }

    $('.send-to-brokers').on('click', function(e){
      e.preventDefault();
      const $button = $(this);
      const $panel = $button.closest('.tab-pane');

      // ---------- Run Validation ----------- //
      if(!validateForm($panel)){
        return; // Stop submission if validation fails
      }

      // Use FormData for both text fields and files
      const formData = new FormData();

      // Include the button's name to determine transaction type
      if ($button.attr('name')) {
        formData.append($button.attr('name'), true);
      }

      // Append all inputs/selects (textual values)
      $panel.find('input, select').each(function(){
        const $el = $(this);
        const name = $el.attr('name');
        if(!name) return;

        if($el.attr('type') === 'file'){
          const files = $el[0].files;
          if(files && files.length){
            for(let i=0; i<files.length; i++){
              formData.append('media_files', files[i]);
            }
          }
        } else if($el.attr('type') === 'checkbox'){
          formData.append(name, $el.is(':checked'));
        } else {
          formData.append(name, $el.val());
        }
      });

      fetch('/api/properties/', {
        method: 'POST',
        headers:{
          'X-CSRFToken': getCookie('csrftoken')
        },
        body: formData
      }).then(r => r.json()).then(function(resp){
        console.log('Property listing created:', resp);
        if (resp.success) {
          alert('Property listing created successfully!');
          // Optionally reset the form except nice-select selects
          $panel.find('input').not('[type="file"]').val('');
          $panel.find('input[type="file"]').val('');
          $panel.find('select').each(function(){
            $(this).val('').niceSelect('update');
          });
        } else {
          alert('Error: ' + (resp.error || 'Failed to create property listing'));
        }
      }).catch(function(err){
        console.error('Error creating property:', err);
        alert('Error creating property listing. Please try again.');
      });
    });
  });
</script>

<!--========== BROKER LISTINGS JS ==========-->
<script>
  document.addEventListener('DOMContentLoaded', function() {

    // --------------------------- UTILITIES ---------------------------
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // --------------------------- FETCH ---------------------------
    async function fetchBrokerProperties() {
      try {
        const res = await fetch('/api/broker-properties/');
        if (!res.ok) throw new Error('Failed to fetch broker properties');
        const data = await res.json();
        if (!data.success) throw new Error(data.error || 'Error fetching properties');
        return data.properties || [];
      } catch (err) {
        console.error(err);
        return [];
      }
    }

    // --------------------------- DELETE ---------------------------
    async function deleteProperty(id, element) {
      if (!confirm('Are you sure you want to delete this property?')) return;
      try {
        const res = await fetch(`/api/broker-properties/${id}/`, {
          method: 'DELETE',
          headers: {
            'X-CSRFToken': getCookie('csrftoken')
          }
        });
        const data = await res.json();
        if (data.success) {
          element.remove();
        } else {
          alert(data.error || 'Failed to delete property.');
        }
      } catch (err) {
        console.error(err);
        alert('Error deleting property.');
      }
    }

    // --------------------------- CARD CREATION ---------------------------
    function createPropertyCard(prop) {
      const template = document.getElementById('broker-property-card-template');
      const cardFragment = template.content.cloneNode(true);
      const cardCol = cardFragment.querySelector('[data-property-id]');
      cardCol.dataset.propertyId = prop.id;

      const img = cardFragment.querySelector('.property-img img');
      if (prop.images && prop.images.length) {
        let src = prop.images[0];
        if (!src.startsWith('http') && !src.startsWith('/')) {
          src = `/media/${src}`;
        }
        img.src = src;
      } else {
        img.src = '{% static "assets/img/placeholder-property.jpg" %}';
      }

      const trans = cardFragment.querySelector('.transaction-type');
      trans.textContent = prop.transaction_type;
      trans.classList.add(prop.transaction_type.toLowerCase().replace(' ', '-'));

      cardFragment.querySelector('.property-title').textContent = prop.property_type;
      cardFragment.querySelector('.location-text').textContent = `${prop.city}, ${prop.area}`;
      cardFragment.querySelector('.property-type').textContent = prop.property_type;
      cardFragment.querySelector('.bedrooms').textContent = prop.bedrooms;
      cardFragment.querySelector('.bathrooms').textContent = prop.bathrooms;
      cardFragment.querySelector('.area').textContent = prop.size;
      cardFragment.querySelector('.price').textContent = prop.price + ' EGP';

      cardFragment.querySelector('.delete-property-btn').addEventListener('click', () => deleteProperty(prop.id, cardCol));

      return cardFragment;
    }

    // --------------------------- RENDER ---------------------------
    async function renderBrokerProperties() {
      const container = document.getElementById('broker-property-cards-container');
      if (!container) return;
      container.innerHTML = '';
      const properties = await fetchBrokerProperties();
      if (properties.length === 0) {
        container.innerHTML = '<div class="col-12 text-center"><p>You have not listed any properties yet.</p></div>';
        return;
      }
      properties.forEach(p => container.appendChild(createPropertyCard(p)));
    }

    // Initial load
    renderBrokerProperties();
  });
</script>
</body>
</html>