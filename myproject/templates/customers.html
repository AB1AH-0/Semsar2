{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Customer</title>

     <!--=====FAB ICON=======-->
    <link rel="shortcut icon" href="{% static 'assets/img/logo/fav-logo.png' %}" type="image/x-icon">

    <!--===== CSS LINK =======-->
    <link rel="stylesheet" href="{% static 'assets/css/plugins/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/aos.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/magnific-popup.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/mobile.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/owlcarousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/slick-slider.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/nice-select.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/main.css' %}">

    <!--=====  JS SCRIPT LINK =======-->
    <script src="{% static 'assets/js/plugins/jquery-3-6-0.min.js' %}"></script>
</head>
<body class="homepage1-body">

<!--===== PRELOADER STARTS =======-->
<div id="preloader">
  <div class="home-icon">
    <div class="roof"></div>
    <div class="walls"></div>
    <div class="door"></div>
      <div class="windows">
          <div class="window"></div>
          <div class="window"></div>
      </div>
  </div>
  <div id="ctn-preloader" class="ctn-preloader">
    <div class="animation-preloader">
        <div class="txt-loading">
            <span data-text-preloader="S" class="letters-loading">
              S
            </span>
            <span data-text-preloader="E" class="letters-loading">
               E
            </span>
            <span data-text-preloader="M" class="letters-loading">
                M
            </span>
            <span data-text-preloader="S" class="letters-loading">
                S
            </span>
            <span data-text-preloader="A" class="letters-loading">
                A
            </span>
            <span data-text-preloader="R" class="letters-loading">
                R
            </span>
        </div>
    </div>
  </div>
</div>
<!--===== PRELOADER ENDS =======-->

  <!--===== PAGE PROGRESS START=======-->
  <div class="paginacontainer">
    <div class="progress-wrap">
      <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
      </svg>
    </div>
  </div>
<!--===== PAGE PROGRESS END=======-->

   <!--=====HEADER START=======-->
   <header>
    <div class="header-area homepage1 inner-menu header header-sticky d-none d-lg-block " id="header">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="header-elements">
              <div class="site-logo">
                <a href="{% url 'home-broker' %}"><img src="{% static 'assets/img/logo/logo2.png' %}" alt=""></a>
              </div>
              <div class="main-menu">
                <ul>
                  <li><a href="{% url 'home-broker' %}">Home</a></li>
                  <li><a href="{% url 'about-broker' %}">About</a></li>
                  <li><a href="{% url 'add-property' %}">Property</a></li>
                  <li><a href="{% url 'customer' %}">Customers</a></li>
                </ul>
              </div>
              
              <div class="btn-area">
                <a href="{% url 'logout' %}" class="header-btn1">Logout <img src="{% static 'assets/img/icons/arrow1.svg' %}" alt=""></a>
              </div>

              <div class="header-search-form-wrapper">
                <div class="tx-search-close tx-close"><i class="fa-solid fa-xmark"></i></div>
                <div class="header-search-container">
                    <form role="search" class="search-form">
                    <input type="search"  class="search-field" placeholder="Search …" value="" name="s">
                    <button type="submit" class="search-submit"><img src="{% static 'assets/img/icons/search1.svg' %}" alt=""></button>
                    </form>
                </div>
            </div>
            <div class="body-overlay"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!--=====HEADER END =======-->

  <!--===== MOBILE HEADER STARTS =======-->
 <div class="mobile-header mobile-haeder1 d-block d-lg-none">
  <div class="container-fluid">
    <div class="col-12">
      <div class="mobile-header-elements">
        <div class="mobile-logo">
          <a href="{% url 'home-broker' %}"><img src="{% static 'assets/img/logo/logo2.png' %}" alt=""></a>
        </div>
        <div class="mobile-nav-icon dots-menu">
          <i class="fa-solid fa-bars-staggered"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="mobile-sidebar mobile-sidebar1">
  <div class="logosicon-area">
    <div class="logos">
      <img src="{% static 'assets/img/logo/logo2.png' %}" alt="">
    </div>
    <div class="menu-close">
      <i class="fa-solid fa-xmark"></i>
    </div>
   </div>
   <div class="mobile-nav mobile-nav1">
    <ul class="mobile-nav-list nav-list1">
      <li><a href="{% url 'home-broker' %}" >Home </a></li>
      <li><a href="{% url 'about-broker' %}">About</a></li>
      <li><a href="{% url 'add-property' %}">Property</a></li>
      <li><a href="{% url 'customer' %}">Customers</a></li>
    </ul>
    <div class="allmobilesection">
      <div class="single-footer">
        <h3>Contact Info</h3>
        <div class="footer1-contact-info">
          <div class="contact-info-single">
            
            
          </div>
          <div class="contact-info-single">
            
            <div class="contact-info-text">
              <a href="mailto:info@example.com">info@example.com</a>
            </div>
          </div>
          <div class="single-footer">
            <h3>Social Links</h3> 
            <div class="social-links-mobile-menu">
              <ul>
                <li><a href="#"><i class="fa-brands fa-facebook-f"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-linkedin-in"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-youtube"></i></a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
     </div>
  </div>
</div> 
<!--===== MOBILE HEADER STARTS =======-->

<!--===== HERO AREA STARTS =======-->
<div class="inner2-section-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-5 m-auto">
                <div class="inner-header heading1 text-center">
                    <a href="{% url 'home-broker' %}">Home <i class="fa-solid fa-angle-right"></i> <span>Customers </span></a>
                    <div class="space20"></div>
                    <h2>Customers</h2>
                </div>
            </div>
        </div>
    </div>
</div>
<!--===== HERO AREA ENDS =======-->
<div class="container my-5">
    <h1 class="mb-4">Customer Inquiries</h1>
    
    {% if inquiries %}
    <div class="table-responsive">
        <table id="inquiry-table" class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Transaction</th>
                    <th>City</th>
                    <th>Area</th>
                    <th>Type</th>
                    <th>Bedrooms</th>
                    <th>Bathrooms</th>
                    <th>Price Range</th>
                    <th>Size</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for inquiry in inquiries %}
                <tr id="inquiry-row-{{ inquiry.id }}" {% if inquiry.broker_post %}style="background-color: #d4edda;"{% endif %}>
                    <td>{{ inquiry.id }}</td>
                    <td>
                        <span class="badge bg-{% if inquiry.transaction_type == 'rent' %}primary{% else %}success{% endif %}">
                            {{ inquiry.get_transaction_type_display }}
                        </span>
                    </td>
                    <td>{{ inquiry.city }}</td>
                    <td>{{ inquiry.area }}</td>
                    <td>{{ inquiry.property_type }}</td>
                    <td>{{ inquiry.bedrooms }}</td>
                    <td>{{ inquiry.bathrooms }}</td>
                    <td>
                        {{ inquiry.min_price|floatformat:0 }} - {{ inquiry.max_price|floatformat:0 }} EGP
                    </td>
                    <td>
                        {{ inquiry.min_size|floatformat:0 }} - {{ inquiry.max_size|floatformat:0 }} m²
                    </td>
                    <td>
                        {% if not inquiry.broker_post %}
                            <button class="btn btn-success btn-sm me-2 accept-btn" data-inquiry-id="{{ inquiry.id }}">
                              <i class="fa-solid fa-circle-check me-1"></i> Accept
                            </button>
                            <button class="btn btn-danger btn-sm reject-btn" data-inquiry-id="{{ inquiry.id }}">
                              <i class="fa-solid fa-circle-xmark me-1"></i> Reject
                            </button>
                        {% else %}
                            <span class="badge bg-success">Accepted</span><br>
                            <small class="text-muted">
                                Broker: {{ inquiry.broker_post.broker_name }}<br>
                                Commission: {{ inquiry.broker_post.commission }}%
                            </small>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info">
        <h4>No Customer Inquiries</h4>
        <p>There are currently no customer inquiries to display. Customer requests will appear here when they submit property search forms.</p>
    </div>
    {% endif %}
</div>

<!-- Success/Error Messages -->
<div id="message-container" style="position: fixed; top: 20px; right: 20px; z-index: 1050;"></div>

<div class="modal fade" id="acceptModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="offer-form">
                <div class="modal-header">
                    <h5 class="modal-title">Send Offer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="inquiry_id" id="offer-inquiry-id">
                    <div class="mb-3">
                        <label class="form-label">Price</label>
                        <input type="number" class="form-control" id="offer-price" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-control" id="offer-location" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Type</label>
                    <input type="text" class="form-control" id="offer-type" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Size</label>
                    <input type="number" class="form-control" id="offer-size" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Bathrooms</label>
                    <input type="number" class="form-control" id="offer-bathrooms" required>
                </div>
            <div class="mb-3">
                <label class="form-label">Bedrooms</label>
                <input type="number" class="form-control" id="offer-bedrooms" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Notes</label>
                <textarea class="form-control" id="offer-notes"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Send</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
    </form>
</div>
</div>
</div>

<!-- Broker Details Modal -->
<div class="modal fade" id="brokerDetailsModal" tabindex="-1" aria-labelledby="brokerDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="brokerDetailsModalLabel">Broker Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="brokerDetailsForm">
          <div class="mb-3">
            <label for="brokerName" class="form-label">Broker Name *</label>
            <input type="text" class="form-control" id="brokerName" name="broker_name" required value="{{ current_broker.full_name }}">
          </div>
          <div class="mb-3">
            <label for="brokerPhone" class="form-label">Phone Number *</label>
            <input type="tel" class="form-control" id="brokerPhone" name="broker_phone" required value="{{ current_broker.phone }}">
          </div>
          <div class="mb-3">
            <label for="commission" class="form-label">Commission (%) *</label>
            <input type="number" class="form-control" id="commission" name="commission" min="0" max="100" step="0.1" required>
          </div>
          <div class="mb-3">
            <label for="brokerNotes" class="form-label">Description</label>
            <textarea class="form-control" id="brokerNotes" name="notes" rows="3" placeholder="Describe your services and experience..."></textarea>
          </div>
          <div class="mb-3">
            <label for="brokerMedia" class="form-label">Media (Optional)</label>
            <input type="file" class="form-control" id="brokerMedia" name="media" accept="image/*,video/*" multiple>
            <div class="form-text">Upload images or videos to showcase your work</div>
          </div>
          <input type="hidden" id="modalInquiryId" name="inquiry_id">
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="sendPostBtn">Send Post</button>
      </div>
    </div>
  </div>
</div>

<!--===== FOOTER AREA STARTS =======-->
<div class="footer1-section-area" style="margin-top: 30%;">
  <div class="container">
    <div class="row">
      <div class="col-lg-4 col-md-6">
        <div class="footer-logo-area">
          <img src="{% static 'assets/img/logo/logo1.png' %}" alt="">
          <div class="space32"></div>
          <h4>inquiries</h4>
          <div class="space16"></div>
          <p>Need to ask questions? Don't hesitate to contact us.</p>
          <form>
            <input type="text" placeholder="Enter Your Email">
            <button type="submit" class="header-btn1">Send <img src="{% static 'assets/img/icons/arrow1.svg' %}" alt=""></button>
          </form>
          <ul>
            <li><a href="#"><i class="fa-brands fa-facebook-f"></i></a></li>
            <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
            <li><a href="#"><i class="fa-brands fa-linkedin-in"></i></a></li>
            <li><a href="#"><i class="fa-brands fa-youtube"></i></a></li>
          </ul>
        </div>
      </div>

      <div class="col-lg col-md-6">
        <div class="footer-header padding-left1">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="{% url 'home-broker' %}">Home</a></li>
            <li><a href="{% url 'add-property' %}">Property></li>
            <li><a href="{% url 'about-broker' %}">About Us</a></li>
            <li><a href="{% url 'customer' %}">Customers</a></li>
          </ul>
        </div>
      </div>

      <div class="col-lg col-md-6">
        <div class="footer-header padding-left">
          
        </div>
      </div>

      <div class="col-lg col-md-6">
        <div class="footer-header">
          <h3>Contact Info</h3>
          <ul>
            <li><span><img src="{% static 'assets/img/icons/location1.svg' %}" alt=""></span><a href="#">82 Beside Banque Misr, Maadi, Cairo, Egypt</a></li>
            <li><span><img src="{% static 'assets/img/icons/call1.svg' %}" alt=""></span><a href="tel:0123456789">0123456789</a></li>
            <li><span><img src="{% static 'assets/img/icons/mail1.svg' %}" alt=""></span><a href="mailto:social@semsar.com">social@semsar.com</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="space50 d-lg-block d-none"></div>
    <div class="space30 d-lg-none d-block"></div>
    <div class="row">
      <div class="col-lg-12">
        <div class="copyright">
          <div class="pera">
            <p>ⓒCopyright 2025 Semsar . All rights reserved</p>
          </div>
          <ul>
            <li><a href="#">Terms & Condition |</a></li>
            <li><a href="#">Privacy</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>


<!--===== FOOTER AREA ENDS =======-->

<!--===== JS SCRIPT LINK =======-->
<script src="{% static 'assets/js/plugins/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/fontawesome.js' %}"></script>
<script src="{% static 'assets/js/plugins/aos.js' %}"></script>
<script src="{% static 'assets/js/plugins/counter.js' %}"></script>
<script src="{% static 'assets/js/plugins/sidebar.js' %}"></script>
<script src="{% static 'assets/js/plugins/magnific-popup.js' %}"></script>
<script src="{% static 'assets/js/plugins/mobilemenu.js' %}"></script>
<script src="{% static 'assets/js/plugins/owlcarousel.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/waypoints.js' %}"></script>
<script src="{% static 'assets/js/plugins/slick-slider.js' %}"></script>
<script src="{% static 'assets/js/plugins/circle-progress.js' %}"></script>
<script src="{% static 'assets/js/plugins/gsap.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/ScrollTrigger.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/Splitetext.js' %}"></script>
<script src="{% static 'assets/js/main.js' %}"></script>
<script src="{% static 'https://code.jquery.com/jquery-3.7.1.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/nice-select.js' %}"></script>

<script>
// Function to show messages
function showMessage(message, type = 'success') {
    const messageContainer = document.getElementById('message-container');
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    messageContainer.appendChild(alertDiv);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.parentNode.removeChild(alertDiv);
        }
    }, 5000);
}

// Function to get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Accept inquiry function
document.addEventListener('DOMContentLoaded', () => {
    const acceptButtons = document.querySelectorAll('.accept-btn');
    acceptButtons.forEach(button => {
        button.addEventListener('click', () => {
            const inquiryId = button.getAttribute('data-inquiry-id');
            
            // Set the inquiry ID in the modal
            document.getElementById('modalInquiryId').value = inquiryId;
            
            // Auto-fill broker information (this should be replaced with actual logged-in broker data)
            // For now, using placeholder data - replace with session/auth data when available
            document.getElementById('brokerName').value = '{{ current_broker.full_name }}';
            document.getElementById('brokerPhone').value = '{{ current_broker.phone }}';
            
            // Clear the editable fields
            document.getElementById('commission').value = '';
            document.getElementById('brokerNotes').value = '';
            document.getElementById('brokerMedia').value = '';
            
            // Show the broker details modal
            const modal = new bootstrap.Modal(document.getElementById('brokerDetailsModal'));
            modal.show();
        });
    });
    
    // Handle Send Post button click
    document.getElementById('sendPostBtn').addEventListener('click', () => {
        const form = document.getElementById('brokerDetailsForm');
        const formData = new FormData(form);
        
        const brokerName = formData.get('broker_name');
        const brokerPhone = formData.get('broker_phone');
        const commission = formData.get('commission');
        const notes = formData.get('notes');
        const media = formData.get('media');
        const inquiryId = formData.get('inquiry_id');
        
        // Validate required fields
        if (!brokerName || !brokerPhone || !commission) {
            showMessage('Please fill in all required fields', 'danger');
            return;
        }
        
        // Send the broker post data
        fetch('/api/inquiries/accept/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showMessage(`Inquiry accepted! Broker: ${formData.get('broker_name')}, Commission: ${formData.get('commission')}%`, 'success');
                
                // Update the row to show accepted status
                const row = document.getElementById(`inquiry-row-${inquiryId}`);
                if (row) {
                    row.style.backgroundColor = '#d4edda';
                    row.querySelector('td:last-child').innerHTML = `
                        <span class="badge bg-success">Accepted</span><br>
                        <small class="text-muted">Broker: ${brokerName}<br>Commission: ${commission}%</small>
                    `;
                }
                
                // Close the modal and reset form
                const modal = bootstrap.Modal.getInstance(document.getElementById('brokerDetailsModal'));
                modal.hide();
                form.reset();
            } else {
                showMessage(data.error || 'Failed to accept inquiry', 'danger');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showMessage('An error occurred while accepting the inquiry', 'danger');
        });
    });
});

// Reject inquiry function
document.addEventListener('DOMContentLoaded', () => {
    const rejectButtons = document.querySelectorAll('.reject-btn');
    rejectButtons.forEach(button => {
        button.addEventListener('click', () => {
            const inquiryId = button.getAttribute('data-inquiry-id');
            if (confirm('Are you sure you want to reject this inquiry? This will permanently delete it.')) {
                fetch('/api/inquiries/reject/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({
                        inquiry_id: inquiryId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showMessage(data.message, 'warning');
                        // Remove the row from the table
                        const row = document.getElementById(`inquiry-row-${inquiryId}`);
                        if (row) {
                            row.remove();
                        }
                        
                        // Check if table is empty and show message
                        const tbody = document.querySelector('#inquiry-table tbody');
                        if (tbody && tbody.children.length === 0) {
                            location.reload(); // Reload to show "No inquiries" message
                        }
                    } else {
                        showMessage(data.error || 'Failed to reject inquiry', 'danger');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showMessage('An error occurred while rejecting the inquiry', 'danger');
                });
            }
        });
    });
});

// Function to periodically check for changes and refresh the page
function checkForUpdates() {
    // Check if there are any accepted inquiries that might have been deleted
    const acceptedRows = document.querySelectorAll('tr[style*="background-color: #d4edda"]');
    if (acceptedRows.length > 0) {
        // Fetch current inquiries to check if any accepted ones were deleted
        fetch('/api/inquiries/')
            .then(response => response.json())
            .then(data => {
                if (data.inquiries) {
                    const currentAcceptedIds = new Set();
                    const currentInquiryIds = new Set();
                    
                    data.inquiries.forEach(inquiry => {
                        currentInquiryIds.add(inquiry.id);
                        if (inquiry.is_accepted && inquiry.broker_post) {
                            currentAcceptedIds.add(inquiry.id);
                        }
                    });
                    
                    // Check if any previously accepted inquiries are no longer accepted or deleted
                    let needsRefresh = false;
                    acceptedRows.forEach(row => {
                        const inquiryId = parseInt(row.id.replace('inquiry-row-', ''));
                        // If the inquiry was deleted entirely or is no longer accepted
                        if (!currentInquiryIds.has(inquiryId) || !currentAcceptedIds.has(inquiryId)) {
                            needsRefresh = true;
                        }
                    });
                    
                    // Also check if any inquiries were completely deleted
                    const allCurrentRows = document.querySelectorAll('tr[id^="inquiry-row-"]');
                    allCurrentRows.forEach(row => {
                        const inquiryId = parseInt(row.id.replace('inquiry-row-', ''));
                        if (!currentInquiryIds.has(inquiryId)) {
                            needsRefresh = true;
                        }
                    });
                    
                    if (needsRefresh) {
                        console.log('Changes detected, refreshing page...');
                        location.reload();
                    }
                }
            })
            .catch(error => {
                console.error('Error checking for updates:', error);
            });
    }
}

// Check for updates every 10 seconds
setInterval(checkForUpdates, 10000);

// Also check when the page becomes visible again (user switches back to tab)
document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
        setTimeout(checkForUpdates, 1000); // Check after 1 second delay
    }
});
</script>

</body>
</html>