{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Brokers</title>

     <!--=====FAB ICON=======-->
    <link rel="shortcut icon" href="{% static 'assets/img/logo/fav-logo.png' %}" type="image/x-icon">

    <!--===== CSS LINK =======-->
    <link rel="stylesheet" href="{% static 'assets/css/plugins/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/aos.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/fontawesome.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/magnific-popup.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/mobile.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/owlcarousel.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/slick-slider.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/plugins/nice-select.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{% static 'assets/css/main.css' %}">

    <!--=====  JS SCRIPT LINK =======-->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="homepage1-body">

<!--===== PRELOADER STARTS =======-->
<div id="preloader">
  <div class="home-icon">
    <div class="roof"></div>
    <div class="walls"></div>
    <div class="door"></div>
      <div class="windows">
          <div class="window"></div>
          <div class="window"></div>
      </div>
  </div>
  <div id="ctn-preloader" class="ctn-preloader">
    <div class="animation-preloader">
        <div class="txt-loading">
            <span data-text-preloader="S" class="letters-loading">
              S
            </span>
            <span data-text-preloader="E" class="letters-loading">
               E
            </span>
            <span data-text-preloader="M" class="letters-loading">
                M
            </span>
            <span data-text-preloader="S" class="letters-loading">
                S
            </span>
            <span data-text-preloader="A" class="letters-loading">
                A
            </span>
            <span data-text-preloader="R" class="letters-loading">
                R
            </span>
        </div>
    </div>
  </div>
</div>
<!--===== PRELOADER ENDS =======-->

  <!--===== PAGE PROGRESS START=======-->
  <div class="paginacontainer">
    <div class="progress-wrap">
      <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
      </svg>
    </div>
  </div>
<!--===== PAGE PROGRESS END=======-->

   <!--=====HEADER START=======-->
   <header>
    <div class="header-area homepage1 inner-menu header header-sticky d-none d-lg-block " id="header">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <div class="header-elements">
              <div class="site-logo">
                <a href="{% url 'home-broker' %}"><img src="{% static 'assets/img/logo/logo2.png' %}" alt=""></a>
              </div>
              <div class="main-menu">
                <ul>
                  <li><a href="{% url 'home-user' %}">Home </a>
                  <li><a href="{% url 'about-user' %}">About</a></li>
                  <li><a href="{% url 'property-user' %}">Property</a></li>
                  <li><a href="{% url 'brokers' %}">Brokers</a></li>
                </ul>
              </div>
              <div class="btn-area">
                <a href="{% url 'logout' %}" class="header-btn1">Logout <img src="{% static 'assets/img/icons/arrow1.svg' %}" alt=""></a>
              </div>

              <div class="header-search-form-wrapper">
                <div class="tx-search-close tx-close"><i class="fa-solid fa-xmark"></i></div>
                <div class="header-search-container">
                    <form role="search" class="search-form">
                    <input type="search"  class="search-field" placeholder="Search â€¦" value="" name="s">
                    <button type="submit" class="search-submit"><img src="{% static 'assets/img/icons/search1.svg' %}" alt=""></button>
                    </form>
                </div>
            </div>
            <div class="body-overlay"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <!--=====HEADER END =======-->

  <!--===== MOBILE HEADER STARTS =======-->
 <div class="mobile-header mobile-haeder1 d-block d-lg-none">
  <div class="container-fluid">
    <div class="col-12">
      <div class="mobile-header-elements">
        <div class="mobile-logo">
          <a href="{% url 'home-user' %}"><img src="{% static 'assets/img/logo/logo2.png' %}" alt=""></a>
        </div>
        <div class="mobile-nav-icon dots-menu">
          <i class="fa-solid fa-bars-staggered"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="mobile-sidebar mobile-sidebar1">
  <div class="logosicon-area">
    <div class="logos">
      <img src="{% static 'assets/img/logo/logo2.png' %}" alt="">
    </div>
    <div class="menu-close">
      <i class="fa-solid fa-xmark"></i>
    </div>
   </div>
   <div class="mobile-nav mobile-nav1">
    <ul class="mobile-nav-list nav-list1">
      <li><a href="{% url 'home-user' %}" >Home </a></li>
      <li><a href="{% url 'about-user' %}">About</a></li>
      <li><a href="{% url 'property-user' %}">Property</a></li>
      <li><a href="{% url 'brokers' %}">Brokers</a></li>
    </ul>
    <div class="allmobilesection">
      <div class="single-footer">
        <h3>Contact Info</h3>
        <div class="footer1-contact-info">
          <div class="contact-info-single">
            <div class="contact-info-icon">
              <span><i class="fa-solid fa-phone-volume"></i></span>
            </div>
            <div class="contact-info-text">
              <a href="tel:+3(924)4596512">+3(924)4596512</a>
            </div>
          </div>
          <div class="contact-info-single">
            <div class="contact-info-icon">
              <span><i class="fa-solid fa-envelope"></i></span>
            </div>
            <div class="contact-info-text">
              <a href="mailto:info@example.com">info@example.com</a>
            </div>
          </div>
          <div class="single-footer">
            <h3>Our Location</h3>
            <div class="contact-info-single">
              <div class="contact-info-icon">
                <span><i class="fa-solid fa-location-dot"></i></span>
              </div>
              <div class="contact-info-text">
                <a href="mailto:info@example.com" >55 East Birchwood Ave.Brooklyn, <br> New York 11201,United States</a>
              </div>
            </div>
          </div>
          <div class="single-footer">
            <h3>Social Links</h3> 
            <div class="social-links-mobile-menu">
              <ul>
                <li><a href="#"><i class="fa-brands fa-facebook-f"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-linkedin-in"></i></a></li>
                <li><a href="#"><i class="fa-brands fa-youtube"></i></a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
     </div>
  </div>
</div>
<!--===== MOBILE HEADER STARTS =======-->

<!--===== HERO AREA STARTS =======-->
<div class="inner2-section-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-5 m-auto">
                <div class="inner-header heading1 text-center">
                    <a href="{% url 'home-user' %}">Home <i class="fa-solid fa-angle-right"></i> <span>Brokers </span></a>
                    <div class="space20"></div>
                    <h2>Brokers</h2>
                </div>
            </div>
        </div>
    </div>
</div>
<!--===== HERO AREA ENDS =======-->

<!--===== PROPERTY AREA STARTS =======-->
<div class="property-inner-area sp1">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
            <div class="listing-tabs-area">
              <ul class="nav nav-pills" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">For Rent</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">For Sale</button>
                </li>
              </ul>
              <div class="space24"></div>
              <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab" tabindex="0">
                  <div class="row">
                    <div class="col-lg-4">
                      <div class="listing-input">
                          <select id="city-rent" name="city-rent" class="city-select nice-select">
                              <option value="" selected disabled>City</option>
                              <option value="cairo">Cairo</option>
                              <option value="giza">Giza</option>
                          </select>
                      </div>
                      <div class="space24"></div>
                    </div>                  
                    <div class="col-lg-4">
                        <div class="listing-input">
                          <select id="area-rent" name="area-rent" class="area-select nice-select">
                            <option value="" disabled selected>Area</option>
    
                            <!-- CAIRO -->
                            
                            <option value="shubra"          data-city="cairo">Shubra</option>
                            <option value="elmarg"          data-city="cairo">El Marg</option>
                            <option value="dar-el-salam"    data-city="cairo">Dar El Salam</option>
                            <option value="maadi"           data-city="cairo">Maadi</option>
                            <option value="nasr-city"       data-city="cairo">Nasr City</option>
                            <option value="mokattam"        data-city="cairo">Mokattam</option>
                            <option value="new-cairo"       data-city="cairo">New Cairo</option>
                            <option value="garden-city"     data-city="cairo">Garden City</option>
                            <option value="al-rehab-city"   data-city="cairo">Al Rehab City</option>

                            <!-- ===================== GIZA ===================== -->
                            <option value="imbaba"            data-city="giza">Imbaba</option>
                            <option value="boulaq-eldakrour"  data-city="giza">Boulaq El-Dakrour</option>
                            <option value="mohandessin"       data-city="giza">Mohandessin</option>
                            <option value="dokki"             data-city="giza">Dokki</option>
                            <option value="agouza"            data-city="giza">Agouza</option>
                            <option value="beverly-hills"     data-city="giza">Beverly Hills</option>
                            <option value="dream-land"        data-city="giza">Dream Land</option>
                            <option value="sheikh-zayed"      data-city="giza">Sheikh Zayed</option>
                        </select>
                        </div>
                        <div class="space24"></div>
                    </div>
                
                    <div class="col-lg-4">
                      <div class="listing-input">
                        <select name="Type-rent" class="nice-select">
                            <option value="" selected disabled>Type</option>
                            <option value="Roof">Roof</option>
                            <option value="Apartment">Apartment</option>
                            <option value="Duplex">Duplex</option>
                            <option value="Villa">Villa</option>
                        </select>
                    </div>
                      <div class="space24"></div>
                  </div>

              <div class="col-lg-4">
                <div class="listing-input">
                  <input  type="number"
                          name="bathrooms-rent"
                          class="nice-select"   
                          placeholder="Bathrooms"
                          min="0"              
                          step="1"           
                          inputmode="numeric">             
                </div>
                <div class="space24"></div>
            </div>
            <div class="col-lg-4">
              <div class="listing-input">
                <input  type="number"
                        name="bedrooms-rent"
                        class="nice-select"   
                        placeholder="Bedrooms"
                        min="0"              
                        step="1"           
                        inputmode="numeric">             
              </div>
              <div class="space24"></div>
          </div>

          <div class="col-lg-4">
           <div class="row">
            <div class="col-lg-6">
              <div class="listing-input">
                <input  type="number"
                        name="min_price-rent"
                        class="nice-select"   
                        placeholder="Min Price (EGP)"
                        min="0"              
                        step="1000"           
                        inputmode="numeric">             
              </div>
            <div class="space24"></div>
            </div>
            
            <div class="col-lg-6">
              <div class="listing-input">
                <input  type="number"
                        name="max_price-rent"
                        class="nice-select"   
                        placeholder="Max Price (EGP)"
                        min="0"              
                        step="1000"           
                        inputmode="numeric">             
              </div>
            <div class="space24"></div>
            </div>
            </div>
            </div>
            
            <div class="col-lg-4">
            <div class="row">
            <div class="col-lg-6">
              <div class="listing-input">
                <input  type="number"
                        name="min_size-rent"
                        class="nice-select"   
                        placeholder="Min Size (mÂ²)"
                        min="0"              
                        step="1"           
                        inputmode="numeric">             
              </div>
            <div class="space24"></div>
            </div>
            
            <div class="col-lg-6">
              <div class="listing-input">
                <input  type="number"
                        name="max_size-rent"
                        class="nice-select"   
                        placeholder="Max Size (mÂ²)"
                        min="0"              
                        step="1"           
                        inputmode="numeric">             
              </div>
             <div class="space24"></div>
           </div>

                <div class="col-lg-6">                 
                    <label>
                      <input type="checkbox" name="Furnished" value="yes">
                      Furnished
                    </label>                              
                  <div class="space24"></div>
              </div>
          </div>
       </div>

       <div class="col-lg-4">
        <div class="row">

        </div>
     </div>

     <div class="col-lg-4">
      <div class="listing-input">

      </div>
      <div class="space24"></div>
  </div>

<div class="col-lg-4">
  <div class="space24"></div>

  <div class="btn-area1">
    <button class="header-btn1 send-to-brokers" type="submit" style="margin-top: 10px;"><img src="{% static 'assets/img/icons/search2.svg' %}" alt=""> Send To Brokers</button>
  </div>
</div>
</div>
</div>
<div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab" tabindex="0">
  <div class="row">
    <div class="col-lg-4">
      <div class="listing-input">
        <select id="city-sale" name="city-sale" class="city-select nice-select">
          <option value="" disabled selected>City</option>
          <option value="cairo">Cairo</option>
          <option value="giza">Giza</option>
      </select>
      </div>
      <div class="space24"></div>
    </div> 

    <div class="col-lg-4">
        <div class="listing-input">
          <select id="area-sale" name="area-sale" class="area-select nice-select">
            <option value="" disabled selected>Area</option>
    
            <!-- CAIRO -->
            
            <option value="shubra"          data-city="cairo">Shubra</option>
            <option value="elmarg"          data-city="cairo">El Marg</option>
            <option value="dar-el-salam"    data-city="cairo">Dar El Salam</option>
            <option value="maadi"           data-city="cairo">Manshiyat Naser</option>
            <option value="nasr-city"       data-city="cairo">Nasr City</option>
            <option value="mokattam"        data-city="cairo">Mokattam</option>
            <option value="new-cairo"       data-city="cairo">New Cairo</option>
            <option value="garden-city"     data-city="cairo">Garden City</option>
            <option value="al-rehab-city"   data-city="cairo">Al Rehab City</option>

            <!-- ===================== GIZA ===================== -->
            <option value="imbaba"            data-city="giza">Imbaba</option>
            <option value="boulaq-eldakrour"  data-city="giza">Boulaq El-Dakrour</option>
            <option value="mohandessin"       data-city="giza">Mohandessin</option>
            <option value="dokki"             data-city="giza">Dokki</option>
            <option value="agouza"            data-city="giza">Agouza</option>
            <option value="beverly-hills"     data-city="giza">Beverly Hills</option>
            <option value="dream-land"        data-city="giza">Dream Land</option>
            <option value="sheikh-zayed"      data-city="giza">Sheikh Zayed</option>
        </select>
        </div>
        <div class="space24"></div>
    </div>


    <div class="col-lg-4">
      <div class="listing-input">
        <select name="Type-rent" class="nice-select">
            <option value="" selected disabled>Type</option>
            <option value="Roof">Roof</option>
            <option value="Apartment">Apartment</option>
            <option value="Duplex">Duplex</option>
            <option value="Villa">Villa</option>
          </select>
    </div>
      <div class="space24"></div>
  </div>

<div class="col-lg-4">
<div class="listing-input">
  <input  type="number"
          name="bathrooms-rent"
          class="nice-select"   
          placeholder="Bathrooms"
          min="0"              
          step="1"           
          inputmode="numeric">             
</div>
<div class="space24"></div>
</div>
<div class="col-lg-4">
<div class="listing-input">
<input  type="number"
        name="bedrooms-rent"
        class="nice-select"   
        placeholder="Bedrooms"
        min="0"              
        step="1"           
        inputmode="numeric">             
</div>
<div class="space24"></div>
</div>

<div class="col-lg-4">
<div class="row">
<div class="col-lg-6">
<div class="listing-input">
<input  type="number"
        name="min_price-rent"
        class="nice-select"   
        placeholder="Min Price (EGP)"
        min="0"              
        step="1000"           
        inputmode="numeric">             
</div>
<div class="space24"></div>
</div>

<div class="col-lg-6">
<div class="listing-input">
<input  type="number"
        name="max_price-rent"
        class="nice-select"   
        placeholder="Max Price (EGP)"
        min="0"              
        step="1000"           
        inputmode="numeric">             
</div>
<div class="space24"></div>
</div>
</div>
</div>

<div class="col-lg-4">
<div class="row">
<div class="col-lg-6">
<div class="listing-input">
<input  type="number"
        name="min_size-rent"
        class="nice-select"   
        placeholder="Min Size (mÂ²)"
        min="0"              
        step="1"           
        inputmode="numeric">             
</div>
<div class="space24"></div>
</div>

<div class="col-lg-6">
<div class="listing-input">
<input  type="number"
        name="max_size-rent"
        class="nice-select"   
        placeholder="Max Size (mÂ²)"
        min="0"              
        step="1"           
        inputmode="numeric">             
</div>
<div class="space24"></div>
</div>

<div class="col-lg-6">                 
    <label>
      <input type="checkbox" name="Furnished" value="yes">
      Furnished
    </label>                              
  <div class="space24"></div>
</div>
</div>
</div>


<div class="col-lg-4">
<div class="listing-input">
  <select name="Finish" class="nice-select">
    <option value="" selected disabled>Finish</option>
    <option value="Finished">Finished</option>
    <option value="Unfinished">Unfinished</option>
    <option value="Semi-Finished">Semi-Finished</option>
</select>
</div>
<div class="space24"></div>
</div>

<div class="col-lg-4">                                        
<div class="space24"></div>
</div>

<div class="col-lg-4">
<div class="space24"></div>
<div class="btn-area1">
  <button class="header-btn1 send-to-brokers" type="submit" style="margin-top: 10px;"><img src="{% static 'assets/img/icons/search2.svg' %}" alt=""> Send To Brokers</button>
</div>
</div>
<div id="inquiry-list" class="space24"></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Broker Offers Section -->
<div class="container my-5">
  <div class="row">
      <div class="col-12">
          <h2 class="mb-4 text-center">Broker Offers for Your Requests</h2>
          <div id="broker-offers-message-container"></div>
          
          <div class="table-responsive">
            <table id="broker-offers-table" class="table table-bordered table-striped">
              <thead class="table-dark">
                  <tr>
                      <th>Request ID</th>
                      <th>Transaction Type</th>
                      <th>City</th>
                      <th>Area</th>
                      <th>Property Type</th>
                      <th>Bedrooms</th>
                      <th>Bathrooms</th>
                      <th>Your Budget</th>
                      <th>Size (mÂ²)</th>
                      <th>Media</th>
                      <th>Broker Response</th>
                      <th>Actions</th>
                  </tr>
              </thead>
              <tbody id="broker-offers-tbody">
                  <!-- Loaded via JavaScript -->
              </tbody>
            </table>
          </div>
          <div id="no-broker-offers-message" class="text-center py-5" style="display: none;">
              <div class="alert alert-info">
                  <i class="fa fa-handshake"></i>
                  <h5>No Broker Offers Yet</h5>
                  <p>When brokers respond to your requests, their offers will appear here.</p>
              </div>
          </div>
      </div>
  </div>
</div>


<!--===== FOOTER AREA STARTS =======-->
<div class="footer1-section-area">
  <div class="container">
    <div class="row">
      <div class="col-lg-4 col-md-6">
        <div class="footer-logo-area">
          <img src="{% static 'assets/img/logo/logo1.png' %}" alt="">
          <div class="space32"></div>
          <h4>Your dream property comes true</h4>
          <div class="space16"></div>
          <p>At Semsar, we are committed to providing exceptional service and support. Whether you are looking buy or rent in real estate, our team is here help.</p>
          
          <ul>
            <li><a href="#"><i class="fa-brands fa-facebook-f"></i></a></li>
            <li><a href="#"><i class="fa-brands fa-instagram"></i></a></li>
            <li><a href="#"><i class="fa-brands fa-linkedin-in"></i></a></li>
            <li><a href="#"><i class="fa-brands fa-youtube"></i></a></li>
          </ul>
        </div>
      </div>

      <div class="col-lg col-md-6">
        <div class="footer-header padding-left1">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="{% url 'home-user' %}">Home</a></li>
            <li><a href="{% url 'about-user' %}">About Us</a></li>
            <li><a href="{% url 'property-user' %}">Properties</a></li>
            <li><a href="{% url 'brokers' %}">Brokers</a></li>
          </ul>
        </div>
      </div>


      <div class="col-lg col-md-6">
        <div class="footer-header">
          <h3>   Info   </h3>
          <ul>
            <li><span><img src="{% static 'assets/img/icons/location1.svg' %}" alt=""></span><a href="">82 Beside Banque Misr, Maadi, Cairo, Egypt</a></li>
            <li><span><img src="{% static 'assets/img/icons/call1.svg' %}" alt=""></span><a href="tel:0123456789">+20123456789</a></li>
            
          </ul>
        </div>
      </div>
    </div>
    <div class="space50 d-lg-block d-none"></div>
    <div class="space30 d-lg-none d-block"></div>
    <div class="row">
      <div class="col-lg-12">
        <div class="copyright">
          <div class="pera">
            <p>â“’Copyright 2025 Semsar . All rights reserved</p>
          </div>
          
        </div>
      </div>
    </div>
  </div>
</div>


<!--===== FOOTER AREA ENDS =======-->

<!-- Broker Registration Modal -->
<div class="modal fade" id="brokerRegistrationModal" tabindex="-1" aria-labelledby="brokerRegistrationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="brokerRegistrationModalLabel">Offer Accepted!</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <div class="mb-4">
          <i class="fa-solid fa-check-circle text-success" style="font-size: 3rem;"></i>
        </div>
        <h6>Your offer has been accepted successfully!</h6>
        <div class="mt-3">
          <p><strong>Broker Registration Number:</strong></p>
          <p class="fs-5 fw-bold text-primary" id="broker-registration-number">BR-2024-000000</p>
        </div>
        <div class="mt-3">
          <p><strong>Broker Phone Number:</strong></p>
          <p class="fs-5 fw-bold text-success" id="broker-phone-number">+20 000 000 0000</p>
        </div>
        <div class="mt-3">
          <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#interviewReviewModal" data-bs-dismiss="modal">Review</button>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it!</button>
      </div>
    </div>
  </div>
</div>
<!-- Media Modal -->
<div class="modal fade" id="mediaModal" tabindex="-1" aria-labelledby="mediaModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="mediaModalLabel">Broker Media</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="mediaCarousel" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <!-- Carousel items will be inserted here -->
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#mediaCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#mediaCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Broker Review Modal -->
<div class="modal fade" id="interviewReviewModal" tabindex="-1" aria-labelledby="interviewReviewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="interviewReviewModalLabel">Broker Review</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Please rate your experience with the broker and confirm if you have done a deal.</p>
        <div class="mb-3">
          <label for="broker-rating" class="form-label">Rating</label>
          <div class="star-rating">
            <i class="fa-solid fa-star" data-value="1"></i>
            <i class="fa-solid fa-star" data-value="2"></i>
            <i class="fa-solid fa-star" data-value="3"></i>
            <i class="fa-solid fa-star" data-value="4"></i>
            <i class="fa-solid fa-star" data-value="5"></i>
          </div>
          <input type="hidden" id="broker-rating" name="rating" value="0">
        </div>
        <div class="mb-3 form-check">
          <input type="checkbox" class="form-check-input" id="deal-done">
          <label class="form-check-label" for="deal-done">I have done a deal.</label>
        </div>
        <input type="hidden" id="deal-id-for-review">
      </div>
      <div id="office-visit-message" class="alert alert-info" style="display: none;">
        <i class="fa-solid fa-map-marker-alt me-2"></i>
        <strong>Visit our office:</strong> 82 Beside Banque Misr, Maadi, Cairo, Egypt
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="submit-review-btn">Submit Review</button>
      </div>
    </div>
  </div>
</div>

<style>
  .star-rating {
    cursor: pointer;
  }
  .star-rating i {
    font-size: 2rem;
    color: #d3d3d3; /* Light gray for unselected stars */
  }
  .star-rating i.selected,
  .star-rating i:hover,
  .star-rating i:hover ~ i {
    color: #f39c12; /* Yellow for selected/hovered stars */
  }
  .star-rating i:hover ~ i {
    color: #d3d3d3;
  }
</style>

<!--===== JS SCRIPT LINK =======-->
<script src="{% static 'assets/js/plugins/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/fontawesome.js' %}"></script>
<script src="{% static 'assets/js/plugins/aos.js' %}"></script>
<script src="{% static 'assets/js/plugins/counter.js' %}"></script>
<script src="{% static 'assets/js/plugins/sidebar.js' %}"></script>
<script src="{% static 'assets/js/plugins/magnific-popup.js' %}"></script>
<script src="{% static 'assets/js/plugins/mobilemenu.js' %}"></script>
<script src="{% static 'assets/js/plugins/owlcarousel.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/waypoints.js' %}"></script>
<script src="{% static 'assets/js/plugins/slick-slider.js' %}"></script>
<script src="{% static 'assets/js/plugins/circle-progress.js' %}"></script>
<script src="{% static 'assets/js/plugins/gsap.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/ScrollTrigger.min.js' %}"></script>
<script src="{% static 'assets/js/plugins/Splitetext.js' %}"></script>
<script src="{% static 'assets/js/main.js' %}"></script>
<script src="{% static 'assets/js/plugins/nice-select.js' %}"></script>

<script>
  $(function () {
    // Initialize nice-select for all select elements
    $('select.nice-select').niceSelect();
    
    // Store all area options for each dropdown
    const allAreaOptions = {};
    
    // Function to store original options
    function storeOriginalOptions(areaSelector) {
        const $area = $(areaSelector);
        allAreaOptions[areaSelector] = [];
        
        $area.find('option').each(function() {
            const $option = $(this);
            allAreaOptions[areaSelector].push({
                value: $option.val(),
                text: $option.text(),
                city: $option.data('city'),
                disabled: $option.prop('disabled'),
                selected: $option.prop('selected')
            });
        });
    }
    
    // Function to link city and area dropdowns
    function linkCityAreaDropdowns(citySelector, areaSelector) {
        const $city = $(citySelector);
        const $area = $(areaSelector);
        
        // Store original options
        storeOriginalOptions(areaSelector);
        
        function filterAreasByCity() {
            const selectedCity = $city.val();
            
            // Clear current options
            $area.empty();
            
            // Add back filtered options
            allAreaOptions[areaSelector].forEach(function(option) {
                // Add option if it has no city data (default option) or matches selected city
                if (!option.city || option.city === selectedCity) {
                    const $newOption = $('<option>', {
                        value: option.value,
                        text: option.text,
                        disabled: option.disabled && !option.city, // Keep default option disabled
                        selected: false // Reset selection
                    });
                    
                    if (option.city) {
                        $newOption.data('city', option.city);
                    }
                    
                    $area.append($newOption);
                }
            });
            
            // Reset to default selection
            $area.val('');
            
            // Destroy and recreate nice-select
            $area.niceSelect('destroy');
            $area.niceSelect();
        }
        
        // Initial filtering when page loads
        filterAreasByCity();
        
        // Filter when city selection changes
        $city.on('change', filterAreasByCity);
    }
    
    // For RENT tab - link city-rent and area-rent
    linkCityAreaDropdowns('select[name="city-rent"]', '#area-rent');
    
    // For SALE tab - link city-sale and area-sale
    linkCityAreaDropdowns('select[name="city-sale"]', '#area-sale');
});

// Capture search data and send to backend
$(function(){
      // --------------------------- INQUIRY FORM VALIDATION --------------------------- //
    function validateInquiryForm($panel){
      let missing = [];

      // Validate all inputs and selects in the form
      $panel.find('input, select').each(function(){
        const $el = $(this);
        // Skip validation for fields that are not visible or are part of a different form system
        if (!$el.is(':visible') || $el.hasClass('select2-hidden-accessible')) {
            return;
        }

        const val = ($el.val() || '').toString().trim();

        // Check for empty value or a disabled placeholder option in a select
        if(val === '' || val === null || ($el.is('select') && $el.find('option:selected').is(':disabled'))){
          let fieldName = $el.closest('.listing-input').find('label').text() || $el.attr('placeholder') || $el.attr('name');
          if (fieldName) {
              fieldName = fieldName.replace(/\*/g, '').trim(); // Clean up label text
              missing.push(fieldName);
          }
        }
      });

      if(missing.length){
        const uniqueMissing = [...new Set(missing)];
        alert('Please complete the following required fields:\n\n- ' + uniqueMissing.join('\n- '));
        return false;
      }
      return true;
    }

    $('.send-to-brokers').on('click', function(e){
    e.preventDefault();
    const $button = $(this);
    const $panel = $button.closest('.tab-pane');
    const $tabContent = $panel.closest('.tab-content');

    // ---------- Run Validation ----------- //
    if(!validateInquiryForm($panel)){
        return; // Stop submission if validation fails
    }

    const data = {};

    // Determine transaction_type based on the active panel's ID
    let transaction_type = '';
    if ($panel.attr('id') === 'pills-home') {
      transaction_type = 'rent';
    } else if ($panel.attr('id') === 'pills-profile') {
      transaction_type = 'sale';
    }
    data['transaction_type'] = transaction_type;
    $panel.find('input, select').each(function(){
      const $el = $(this);
      let name = $el.attr('name');
      if(!name) return;
      // Normalize field names: strip -rent/-sale suffix and map Type -> property_type
      name = name.replace(/-(rent|sale)$/,'').toLowerCase();
      if(name === 'type') name = 'property_type';
      if($el.attr('type') === 'checkbox'){
        data[name] = $el.is(':checked');
      } else {
        data[name] = $el.val();
      }
    });
    fetch('/api/inquiries/', {
      method: 'POST',
      headers:{
        'Content-Type':'application/json',
        'X-CSRFToken': getCookie('csrftoken')
      },
      body: JSON.stringify(data)
    }).then(r => r.json()).then(function(resp){
      console.log('saved', resp);
      // Empty the form panel's content
      $panel.empty();
      // Show a success message inside the panel
      $panel.append('<div class="alert alert-success" role="alert" style="margin-top: 20px;">Your inquiry has been successfully submitted! Brokers will contact you soon.<br><br><button class="btn btn-primary" onclick="window.location.reload();">Make Another Inquiry</button></div>');
      // Ensure the panel is visible if it was hidden by other logic (though unlikely here)
      $panel.show();
      
      // Refresh the inquiries table to show the new submission
      setTimeout(function() {
        loadCustomerInquiries();
      }, 1000);
      
      // Optionally, remove the success message after a few seconds
      // setTimeout(function() {
      //     $tabContent.find('.alert-success').remove();
      //     // Optionally, show the form again or redirect
      // }, 5000);
    }).catch(function(err){
      console.error('error', err);
      // Optionally, display an error message to the user within the panel
      $panel.prepend('<div class="alert alert-danger">Could not submit your inquiry. Please try again.</div>');
    });
  });
});

  // Load customer inquiries on page load
  function loadCustomerInquiries() {
    // Early exit if the inquiries table is not present on this page
    const tbody = document.getElementById('inquiries-tbody');
    const noInquiriesMessage = document.getElementById('no-inquiries-message');
    const table = document.getElementById('customer-inquiries-table');
    if(!tbody || !noInquiriesMessage || !table) {
      return; // Elements not found, skip loading
    }
    fetch('/api/inquiries/')
      .then(response => response.json())
      .then(data => {
        tbody.innerHTML = '';
        table.style.display = 'table';
        noInquiriesMessage.style.display = 'none';
        
        if (data.inquiries && data.inquiries.length > 0) {
          data.inquiries.forEach(inquiry => {
            const row = document.createElement('tr');
            
            // Highlight accepted inquiries
            if (inquiry.is_accepted) {
              row.style.backgroundColor = '#d4edda';
            }
            
            // Format location
            const location = `${inquiry.city || 'N/A'}${inquiry.area ? ', ' + inquiry.area : ''}`;
            
            // Format property details
            const propertyDetails = `${inquiry.property_type || 'N/A'} - ${inquiry.bedrooms || 'N/A'} BR, ${inquiry.bathrooms || 'N/A'} Bath`;
            
            // Format price range
            let priceRange = 'N/A';
            if (inquiry.min_price && inquiry.max_price) {
              priceRange = `${Number(inquiry.min_price).toLocaleString()} - ${Number(inquiry.max_price).toLocaleString()} EGP`;
            } else if (inquiry.min_price) {
              priceRange = `From ${Number(inquiry.min_price).toLocaleString()} EGP`;
            } else if (inquiry.max_price) {
              priceRange = `Up to ${Number(inquiry.max_price).toLocaleString()} EGP`;
            }
            
            // Format status and broker response
            let statusHtml = '<span class="badge bg-warning">Pending</span>';
            let brokerResponseHtml = '<span class="text-muted">No response yet</span>';
            
            if (inquiry.is_accepted && inquiry.broker_post) {
              statusHtml = '<span class="badge bg-success">Accepted</span>';
              brokerResponseHtml = `
                <div class="small">
                  <strong>Broker:</strong> ${inquiry.broker_post.broker_name}<br>
                  <strong>Commission:</strong> ${inquiry.broker_post.commission}%<br>
                  <strong>Accepted:</strong> ${new Date(inquiry.broker_post.accepted_at).toLocaleDateString()}
                  ${inquiry.broker_post.notes ? '<br><strong>Notes:</strong> ' + inquiry.broker_post.notes : ''}
                </div>
              `;
            }
            
            row.innerHTML = `
              <td>${inquiry.id}</td>
              <td><span class="badge bg-${inquiry.transaction_type === 'rent' ? 'primary' : 'success'}">${inquiry.transaction_type}</span></td>
              <td>${location}</td>
              <td>${propertyDetails}</td>
              <td>${priceRange}</td>
              <td>${new Date(inquiry.created_at).toLocaleDateString()}</td>
              <td>${statusHtml}</td>
              <td>${brokerResponseHtml}</td>
            `;
            
            tbody.appendChild(row);
          });
        } else {
          table.style.display = 'none';
          noInquiriesMessage.style.display = 'block';
        }
      })
      .catch(error => {
        console.error('Error loading inquiries:', error);
        document.getElementById('inquiries-message-container').innerHTML = 
          '<div class="alert alert-danger">Error loading property requests. Please refresh the page.</div>';
      });
  }
  
  // Load inquiries when page loads
  loadCustomerInquiries();
  
  // Refresh inquiries every 30 seconds to show new broker responses
  setInterval(loadCustomerInquiries, 30000); 

// --- Main Data Loading and Rendering ---
function loadBrokerOffers() {
    fetch('/api/inquiries/')
        .then(response => response.json())
        .then(data => {
            const tbody = document.getElementById('broker-offers-tbody');
            const noOffersMessage = document.getElementById('no-broker-offers-message');
            const table = document.getElementById('broker-offers-table');

            const offersData = data.inquiries ? data.inquiries.filter(inquiry => 
                inquiry.is_accepted && inquiry.broker_post && inquiry.deal_status !== 'rejected'
            ) : [];

            if (offersData.length > 0) {
                tbody.innerHTML = '';
                table.style.display = 'table';
                noOffersMessage.style.display = 'none';

                offersData.forEach(inquiry => {
                    const row = document.createElement('tr');
                    let priceRange = 'N/A';
                    if (inquiry.min_price && inquiry.max_price) {
                        priceRange = `${Number(inquiry.min_price).toLocaleString()} - ${Number(inquiry.max_price).toLocaleString()} EGP`;
                    } else if (inquiry.min_price) {
                        priceRange = `From ${Number(inquiry.min_price).toLocaleString()} EGP`;
                    } else if (inquiry.max_price) {
                        priceRange = `Up to ${Number(inquiry.max_price).toLocaleString()} EGP`;
                    }

                    let sizeRange = 'N/A';
                    if (inquiry.min_size && inquiry.max_size) {
                        sizeRange = `${inquiry.min_size} - ${inquiry.max_size} mÂ²`;
                    } else if (inquiry.min_size) {
                        sizeRange = `From ${inquiry.min_size} mÂ²`;
                    } else if (inquiry.max_size) {
                        sizeRange = `Up to ${inquiry.max_size} mÂ²`;
                    }

                    let actionsHtml = '';
                    switch (inquiry.deal_status) {
                        case 'offer_pending':
                            actionsHtml = `
                                <button class="btn btn-success btn-sm me-2 accept-offer-btn" data-inquiry-id="${inquiry.id}">
                                    <i class="fa-solid fa-check"></i> Accept
                                </button>
                                <button class="btn btn-danger btn-sm reject-offer-btn" data-inquiry-id="${inquiry.id}">
                                    <i class="fa-solid fa-times"></i> Reject
                                </button>
                            `;
                            break;
                        case 'pending_review':
                            actionsHtml = `<span class="badge bg-info text-dark">Review Pending...</span>`;
                            break;
                        case 'completed':
                            let starsHtml = '';
                            for (let i = 1; i <= 5; i++) {
                                starsHtml += `<i class="fa-solid fa-star ${i <= inquiry.deal_rating ? 'text-warning' : 'text-secondary'}"></i>`;
                            }
                            actionsHtml = `<div class="text-success small"><strong>Completed</strong><br>${starsHtml}</div>`;
                            break;
                        default:
                            actionsHtml = `
                                <div class="text-center">
                                    <span class="text-muted">Processing...</span><br>
                                    <button class="btn btn-primary btn-sm mt-2 update-details-btn" data-bs-toggle="modal" data-bs-target="#brokerRegistrationModal" data-inquiry-id="${inquiry.id}">
                                        <i class="fa-solid fa-edit"></i> Update
                                    </button>
                                    <button class="btn btn-danger btn-sm mt-2 delete-offer-btn" data-deal-id="${inquiry.deal_id}">
                                        <i class="fa-solid fa-trash"></i> Delete
                                    </button>
                                </div>
                            `;
                    }

                    let mediaButtonHtml = '<span class="text-muted">No Media</span>';
                    if (inquiry.broker_post.media && inquiry.broker_post.media.length > 0) {
                        mediaButtonHtml = `<button class="btn btn-info btn-sm show-media-btn" data-media='${JSON.stringify(inquiry.broker_post.media)}' data-bs-toggle="modal" data-bs-target="#mediaModal">
                                            <i class="fa-solid fa-photo-film"></i> Show Media
                                          </button>`;
                    }

                    row.innerHTML = `
                        <td>${inquiry.id}</td>
                        <td><span class="badge bg-${inquiry.transaction_type.toLowerCase() === 'rent' ? 'primary' : 'success'}">${inquiry.transaction_type}</span></td>
                        <td>${inquiry.city || 'N/A'}</td>
                        <td>${inquiry.area || 'N/A'}</td>
                        <td>${inquiry.property_type || 'N/A'}</td>
                        <td>${inquiry.bedrooms || 'N/A'}</td>
                        <td>${inquiry.bathrooms || 'N/A'}</td>
                        <td>${priceRange}</td>
                        <td>${sizeRange}</td>
                        <td>${mediaButtonHtml}</td>
                        <td>
                            <div class="small bg-light p-2 rounded">
                                <div class="mb-1"><strong>Broker:</strong> ${inquiry.broker_post.broker_name}</div>
                                <div class="mb-1"><strong>Commission:</strong> ${inquiry.broker_post.commission}%</div>
                                <div class="mb-1"><strong>Accepted:</strong> ${new Date(inquiry.broker_post.accepted_at).toLocaleDateString()}</div>
                                ${inquiry.broker_post.notes ? '<div><strong>Notes:</strong> ' + inquiry.broker_post.notes + '</div>' : ''}
                            </div>
                        </td>
                        <td class="action-cell">${actionsHtml}</td>
                    `;
                    tbody.appendChild(row);
                });
            } else {
                table.style.display = 'none';
                noOffersMessage.style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Error loading broker offers:', error);
            document.getElementById('broker-offers-message-container').innerHTML = 
                '<div class="alert alert-danger">Error loading broker offers. Please refresh the page.</div>';
        });
}

// --- Event Delegation for Actions ---
document.getElementById('broker-offers-tbody').addEventListener('click', function(event) {
    const target = event.target.closest('button');
    if (!target) return;

    if (target.classList.contains('show-media-btn')) {
        const mediaFiles = JSON.parse(target.dataset.media);
        const carouselInner = document.querySelector('#mediaModal .carousel-inner');
        carouselInner.innerHTML = ''; // Clear previous media

        mediaFiles.forEach((file, index) => {
            const carouselItem = document.createElement('div');
            carouselItem.className = `carousel-item ${index === 0 ? 'active' : ''}`;
            
            let mediaElement;
            if (file.toLowerCase().endsWith('.mp4') || file.toLowerCase().endsWith('.mov')) {
                mediaElement = document.createElement('video');
                mediaElement.src = file;
                mediaElement.className = 'd-block w-100';
                mediaElement.controls = true;
            } else {
                mediaElement = document.createElement('img');
                mediaElement.src = file;
                mediaElement.className = 'd-block w-100';
                mediaElement.alt = 'Broker media';
            }
            
            carouselItem.appendChild(mediaElement);
            carouselInner.appendChild(carouselItem);
        });
    }

    const inquiryId = target.dataset.inquiryId;
    if (target.classList.contains('accept-offer-btn')) {
        acceptOffer(inquiryId);
    } else if (target.classList.contains('reject-offer-btn')) {
        rejectOffer(inquiryId);
    } else if (target.classList.contains('delete-offer-btn')) {
        const dealId = target.dataset.dealId;
        if (dealId && dealId !== 'null') {
            deleteOffer(dealId);
        } else {
            alert('Cannot delete, deal ID is missing.');
        }
    }
});

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// --- API Call Functions ---
function acceptOffer(inquiryId) {
    const csrfToken = getCookie('csrftoken');
    $.ajax({
        url: `/api/deals/accept/${inquiryId}/`,
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ inquiry_id: inquiryId }),
        beforeSend: xhr => xhr.setRequestHeader('X-CSRFToken', csrfToken),
        success: response => {
            if (response.success) {
              $('#broker-phone-number').text(response.broker_phone);
                $('#broker-registration-number').text(response.broker_registration_number);
                const registrationModal = new bootstrap.Modal(document.getElementById('brokerRegistrationModal'));
                registrationModal.show();



                loadBrokerOffers();
            } else {
                alert('Error: ' + response.error);
            }
        },
        error: () => alert('An error occurred while accepting the offer.')
    });
}

const deleteDealUrl = "{% url 'delete_deal' 0 %}".replace(/0\/?$/, '');

function deleteOffer(dealId) {
    if (!confirm('Are you sure you want to delete this accepted offer? This action cannot be undone.')) return;

    const csrfToken = getCookie('csrftoken');
    $.ajax({
        url: `${deleteDealUrl}${dealId}/`,
        type: 'POST',
        beforeSend: xhr => xhr.setRequestHeader('X-CSRFToken', csrfToken),
        success: response => {
            if (response.success) {
                loadBrokerOffers();
            } else {
                alert('Error: ' + response.error);
            }
        },
        error: () => alert('An error occurred while deleting the offer.')
    });
}

function rejectOffer(inquiryId) {
    if (!confirm('Are you sure you want to reject this offer?')) return;

    const csrfToken = getCookie('csrftoken');
    $.ajax({
        url: `/api/deals/reject/${inquiryId}/`,
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ inquiry_id: inquiryId }),
        beforeSend: xhr => xhr.setRequestHeader('X-CSRFToken', csrfToken),
        success: response => {
            if (response.success) {
                loadBrokerOffers();
            } else {
                alert('Error: ' + response.error);
            }
        },
        error: () => alert('An error occurred while rejecting the offer.')
    });
}

// --- Star Rating Logic ---
const stars = document.querySelectorAll('.star-rating .fa-star');
const ratingInput = document.getElementById('broker-rating');

function resetStars() {
    stars.forEach(star => star.classList.remove('selected'));
}

function setStars(rating) {
    resetStars();
    for (let i = 0; i < rating; i++) {
        stars[i].classList.add('selected');
    }
}

stars.forEach(star => {
    star.addEventListener('mouseover', () => setStars(star.dataset.value));
    star.addEventListener('mouseout', () => setStars(ratingInput.value));
    star.addEventListener('click', () => {
        ratingInput.value = star.dataset.value;
        setStars(ratingInput.value);
    });
});

// --- Review Submission ---
$('#submit-review-btn').on('click', function() {
    const dealId = $('#deal-id-for-review').val();
    const rating = $('#broker-rating').val();
    const commissionPaid = $('#commission-paid').is(':checked');
    const csrfToken = getCookie('csrftoken');

    if (rating === '0') {
        alert('Please select a rating from 1 to 5 stars.');
        return;
    }

    $.ajax({
        url: `/api/deals/review/${dealId}/`,
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            deal_id: dealId,
            rating: rating,
            commission_paid: commissionPaid
        }),
        beforeSend: xhr => xhr.setRequestHeader('X-CSRFToken', csrfToken),
        success: response => {
            if (response.success) {
                const reviewModal = bootstrap.Modal.getInstance(document.getElementById('interviewReviewModal'));
                reviewModal.hide();
                loadBrokerOffers();
            } else {
                alert('Error: ' + response.error);
            }
        },
        error: () => alert('An error occurred while submitting the review.')
    });
});

// --- Initial Load and Refresh ---
$(document).ready(function() {
    loadBrokerOffers();
    setInterval(loadBrokerOffers, 30000); // Refresh every 30 seconds
});
// Add event listener for deal done checkbox
$('#deal-done').change(function() {
    if (this.checked) {
        $('#office-visit-message').show();
    } else {
        $('#office-visit-message').hide();
    }
});
</script>
</body>

</html>